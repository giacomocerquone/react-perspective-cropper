{"version":3,"file":"index.js","sources":["../src/lib/utils.js","../src/lib/CropPoint.jsx","../src/lib/CropPoints.jsx","../src/lib/imgManipulation.js","../src/lib/CropPointsDelimiters.jsx","../src/lib/Canvas.jsx","../src/components/Cropper.jsx"],"sourcesContent":["export const readFile = (file) => {\n  if (file instanceof File) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onload = (event) => {\n        resolve(reader.result)\n      }\n      reader.onerror = (err) => {\n        reject(err)\n      }\n      reader.readAsDataURL(file)\n    })\n  }\n  if (typeof file === 'string') {\n    return Promise.resolve(file)\n  }\n}\n\nexport const calcDims = (\n  width,\n  height,\n  externalMaxWidth,\n  externalMaxHeight\n) => {\n  const ratio = width / height\n\n  const maxWidth = externalMaxWidth || window.innerWidth\n  const maxHeight = externalMaxHeight || window.innerHeight\n  const calculated = {\n    width: maxWidth,\n    height: Math.round(maxWidth / ratio),\n    ratio: ratio\n  }\n\n  if (calculated.height > maxHeight) {\n    calculated.height = maxHeight\n    calculated.width = Math.round(maxHeight * ratio)\n  }\n  return calculated\n}\n\nexport function isCrossOriginURL(url) {\n  const { location } = window;\n  const parts = url.match(/^(\\w+:)\\/\\/([^:/?#]*):?(\\d*)/i);\n\n  return (\n    parts !== null &&\n    (parts[1] !== location.protocol ||\n      parts[2] !== location.hostname ||\n      parts[3] !== location.port)\n  );\n}","import React, { useCallback } from 'react'\nimport Draggable from 'react-draggable'\nimport T from 'prop-types'\n\nconst buildCropPointStyle = (size, pointBgColor, pointBorder) => ({\n  width: size,\n  height: size,\n  backgroundColor: pointBgColor,\n  border: pointBorder,\n  borderRadius: '100%',\n  position: 'absolute',\n  zIndex: 1001\n})\n\nconst CropPoint = ({\n  cropPoints,\n  pointArea,\n  defaultPosition,\n  pointSize,\n  pointBgColor = 'transparent',\n  pointBorder = '4px solid #3cabe2',\n  onStop: externalOnStop,\n  onDrag: externalOnDrag,\n  bounds\n}) => {\n  const onDrag = useCallback(\n    (_, position) => {\n      externalOnDrag(\n        {\n          ...position,\n          x: position.x + pointSize / 2,\n          y: position.y + pointSize / 2\n        },\n        pointArea\n      )\n    },\n    [externalOnDrag]\n  )\n\n  const onStop = useCallback(\n    (_, position) => {\n      externalOnStop(\n        {\n          ...position,\n          x: position.x + pointSize / 2,\n          y: position.y + pointSize / 2\n        },\n        pointArea,\n        cropPoints\n      )\n    },\n    [externalOnDrag, cropPoints]\n  )\n\n  return (\n    <Draggable\n      bounds={bounds}\n      defaultPosition={defaultPosition}\n      position={{\n        x: cropPoints[pointArea].x - pointSize / 2,\n        y: cropPoints[pointArea].y - pointSize / 2\n      }}\n      onDrag={onDrag}\n      onStop={onStop}\n    >\n      <div style={buildCropPointStyle(pointSize, pointBgColor, pointBorder)} />\n    </Draggable>\n  )\n}\n\nexport default CropPoint\n\nCropPoint.propTypes = {\n  cropPoints: T.shape({\n    'left-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-bottom': T.shape({ x: T.number, y: T.number }).isRequired,\n    'left-bottom': T.shape({ x: T.number, y: T.number }).isRequired\n  }),\n  pointArea: T.oneOf(['left-top', 'right-top', 'right-bottom', 'left-bottom']),\n  defaultPosition: T.shape({\n    x: T.number,\n    y: T.number\n  }),\n  pointSize: T.number,\n  pointBgColor: T.string,\n  pointBorder: T.string,\n  onStop: T.func,\n  onDrag: T.func\n}\n","import React, { Fragment } from 'react'\nimport CropPoint from './CropPoint'\nimport T from 'prop-types'\n\nconst CropPoints = (props) => {\n  const { previewDims, ...otherProps } = props\n  return (\n    <>\n      <CropPoint\n        pointArea='left-top'\n        defaultPosition={{ x: 0, y: 0 }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='right-top'\n        defaultPosition={{ x: previewDims.width, y: 0 }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='right-bottom'\n        defaultPosition={{ x: 0, y: previewDims.height }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='left-bottom'\n        defaultPosition={{\n          x: previewDims.width,\n          y: previewDims.height\n        }}\n        {...otherProps}\n      />\n    </>\n  )\n}\n\nexport default CropPoints\n\nCropPoints.propTypes = {\n  previewDims: T.shape({\n    ratio: T.number,\n    width: T.number,\n    height: T.number\n  })\n}\n","export const transform = (\n  cv,\n  docCanvas,\n  cropPoints,\n  imageResizeRatio,\n  setPreviewPaneDimensions\n) => {\n  const dst = cv.imread(docCanvas)\n\n  const bR = cropPoints['right-bottom']\n  const bL = cropPoints['left-bottom']\n  const tR = cropPoints['right-top']\n  const tL = cropPoints['left-top']\n\n  // create source coordinates matrix\n  const sourceCoordinates = [tL, tR, bR, bL].map((point) => [\n    point.x / imageResizeRatio,\n    point.y / imageResizeRatio\n  ])\n\n  // get max width\n  const maxWidth = Math.max(bR.x - bL.x, tR.x - tL.x) / imageResizeRatio\n  // get max height\n  const maxHeight = Math.max(bL.y - tL.y, bR.y - tR.y) / imageResizeRatio\n\n  // create dest coordinates matrix\n  const destCoordinates = [\n    [0, 0],\n    [maxWidth - 1, 0],\n    [maxWidth - 1, maxHeight - 1],\n    [0, maxHeight - 1]\n  ]\n\n  // convert to open cv matrix objects\n  const Ms = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...sourceCoordinates))\n  const Md = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...destCoordinates))\n  const transformMatrix = cv.getPerspectiveTransform(Ms, Md)\n  // set new image size\n  const dsize = new cv.Size(maxWidth, maxHeight)\n  // perform warp\n  cv.warpPerspective(\n    dst,\n    dst,\n    transformMatrix,\n    dsize,\n    cv.INTER_LINEAR,\n    cv.BORDER_CONSTANT,\n    new cv.Scalar()\n  )\n  cv.imshow(docCanvas, dst)\n\n  dst.delete()\n  Ms.delete()\n  Md.delete()\n  transformMatrix.delete()\n\n  setPreviewPaneDimensions()\n}\n\nexport const applyFilter = async (cv, docCanvas, filterCvParams) => {\n  // default options\n  const options = {\n    blur: false,\n    th: true,\n    thMode: cv.ADAPTIVE_THRESH_MEAN_C,\n    thMeanCorrection: 15,\n    thBlockSize: 25,\n    thMax: 255,\n    grayScale: true,\n    ...filterCvParams\n  }\n  const dst = cv.imread(docCanvas)\n\n  if (options.grayScale) {\n    cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0)\n  }\n  if (options.blur) {\n    const ksize = new cv.Size(5, 5)\n    cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT)\n  }\n  if (options.th) {\n    if (options.grayScale) {\n      cv.adaptiveThreshold(\n        dst,\n        dst,\n        options.thMax,\n        options.thMode,\n        cv.THRESH_BINARY,\n        options.thBlockSize,\n        options.thMeanCorrection\n      )\n    } else {\n      dst.convertTo(dst, -1, 1, 60)\n      cv.threshold(dst, dst, 170, 255, cv.THRESH_BINARY)\n    }\n  }\n  cv.imshow(docCanvas, dst)\n}\n","import React, { useCallback, useEffect, useRef } from 'react'\nimport T from 'prop-types'\n\nconst CropPointsDelimiters = ({\n  cropPoints,\n  previewDims,\n  lineWidth = 3,\n  lineColor = '#3cabe2',\n  pointSize\n}) => {\n  const canvas = useRef()\n\n  const clearCanvas = useCallback(() => {\n    const ctx = canvas.current.getContext('2d')\n    ctx.clearRect(0, 0, previewDims.width, previewDims.height)\n  }, [canvas.current, previewDims])\n\n  const sortPoints = useCallback(() => {\n    const sortOrder = ['left-top', 'right-top', 'right-bottom', 'left-bottom']\n    return sortOrder.reduce(\n      (acc, pointPos) => [...acc, cropPoints[pointPos]],\n      []\n    )\n  }, [cropPoints])\n\n  const drawShape = useCallback(\n    ([point1, point2, point3, point4]) => {\n      const ctx = canvas.current.getContext('2d')\n      ctx.lineWidth = lineWidth\n      ctx.strokeStyle = lineColor\n\n      ctx.beginPath()\n      ctx.moveTo(point1.x + pointSize / 2, point1.y)\n      ctx.lineTo(point2.x - pointSize / 2, point2.y)\n\n      ctx.moveTo(point2.x, point2.y + pointSize / 2)\n      ctx.lineTo(point3.x, point3.y - pointSize / 2)\n\n      ctx.moveTo(point3.x - pointSize / 2, point3.y)\n      ctx.lineTo(point4.x + pointSize / 2, point4.y)\n\n      ctx.moveTo(point4.x, point4.y - pointSize / 2)\n      ctx.lineTo(point1.x, point1.y + pointSize / 2)\n      ctx.closePath()\n      ctx.stroke()\n    },\n    [canvas.current]\n  )\n\n  useEffect(() => {\n    if (cropPoints && canvas.current) {\n      clearCanvas()\n      const sortedPoints = sortPoints()\n      drawShape(sortedPoints)\n    }\n  }, [cropPoints, canvas.current])\n\n  return (\n    <canvas\n      ref={canvas}\n      style={{\n        position: 'absolute',\n        zIndex: 5\n      }}\n      width={previewDims.width}\n      height={previewDims.height}\n    />\n  )\n}\n\nexport default CropPointsDelimiters\n\nCropPointsDelimiters.propTypes = {\n  previewDims: T.shape({\n    ratio: T.number,\n    width: T.number,\n    height: T.number\n  }),\n  cropPoints: T.shape({\n    'left-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-bottom': T.shape({ x: T.number, y: T.number }).isRequired,\n    'left-bottom': T.shape({ x: T.number, y: T.number }).isRequired\n  }),\n  lineColor: T.string,\n  lineWidth: T.number,\n  pointSize: T.number\n}\n","import React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n  Fragment\n} from 'react'\nimport { useOpenCv } from 'opencv-react'\nimport T from 'prop-types'\n\nimport { calcDims, readFile, isCrossOriginURL } from '../lib/utils'\nimport CropPoints from '../lib/CropPoints'\nimport { applyFilter, transform } from '../lib/imgManipulation'\nimport CropPointsDelimiters from './CropPointsDelimiters'\n\nconst buildImgContainerStyle = (previewDims) => ({\n  width: previewDims.width,\n  height: previewDims.height\n})\n\nconst imageDimensions = { width: 0, height: 0 }\nlet imageResizeRatio\n\nconst Canvas = ({\n  image,\n  onDragStop,\n  onChange,\n  cropperRef,\n  pointSize = 30,\n  lineWidth,\n  pointBgColor,\n  pointBorder,\n  lineColor,\n  maxWidth,\n  maxHeight\n}) => {\n  const { loaded: cvLoaded, cv } = useOpenCv()\n  const canvasRef = useRef()\n  const previewCanvasRef = useRef()\n  const magnifierCanvasRef = useRef()\n  const [previewDims, setPreviewDims] = useState()\n  const [cropPoints, setCropPoints] = useState()\n  const [loading, setLoading] = useState(false)\n  const [mode, setMode] = useState('crop')\n\n  useImperativeHandle(cropperRef, () => ({\n    backToCrop: () => {\n      setMode('crop')\n    },\n    done: async (opts = {}) => {\n      return new Promise((resolve) => {\n        setLoading(true)\n        transform(\n          cv,\n          canvasRef.current,\n          cropPoints,\n          imageResizeRatio,\n          setPreviewPaneDimensions\n        )\n        applyFilter(cv, canvasRef.current, opts.filterCvParams)\n        if (opts.preview) {\n          setMode('preview')\n        }\n        canvasRef.current.toBlob((blob) => {\n          blob.name = image.name\n          resolve(blob)\n          setLoading(false)\n        }, image.type)\n      })\n    }\n  }))\n\n  useEffect(() => {\n    if (mode === 'preview') {\n      showPreview()\n    }\n  }, [mode])\n\n  const setPreviewPaneDimensions = () => {\n    // set preview pane dimensions\n    const newPreviewDims = calcDims(\n      canvasRef.current.width,\n      canvasRef.current.height,\n      maxWidth,\n      maxHeight\n    )\n    setPreviewDims(newPreviewDims)\n\n    previewCanvasRef.current.width = newPreviewDims.width\n    previewCanvasRef.current.height = newPreviewDims.height\n\n    imageResizeRatio = newPreviewDims.width / canvasRef.current.width\n  }\n\n  const createCanvas = (src) => {\n    return new Promise((resolve, reject) => {\n      const img = document.createElement('img')\n      img.onload = async () => {\n        // set edited image canvas and dimensions\n        canvasRef.current = document.createElement('canvas')\n        canvasRef.current.width = img.width\n        canvasRef.current.height = img.height\n        const ctx = canvasRef.current.getContext('2d')\n        ctx.drawImage(img, 0, 0)\n        imageDimensions.width = canvasRef.current.width\n        imageDimensions.height = canvasRef.current.height\n        setPreviewPaneDimensions()\n        resolve()\n      }\n      if (isCrossOriginURL(src)) img.crossOrigin = \"anonymous\"\n      img.src = src\n    })\n  }\n\n  const showPreview = (image) => {\n    const src = image || cv.imread(canvasRef.current)\n    const dst = new cv.Mat()\n    const dsize = new cv.Size(0, 0)\n    cv.resize(\n      src,\n      dst,\n      dsize,\n      imageResizeRatio,\n      imageResizeRatio,\n      cv.INTER_AREA\n    )\n    cv.imshow(previewCanvasRef.current, dst)\n    src.delete()\n    dst.delete()\n  }\n\n  const detectContours = () => {\n    const dst = cv.imread(canvasRef.current)\n    const ksize = new cv.Size(5, 5)\n    // convert the image to grayscale, blur it, and find edges in the image\n    cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0)\n    cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT)\n    cv.Canny(dst, dst, 75, 200)\n    // find contours\n    cv.threshold(dst, dst, 120, 200, cv.THRESH_BINARY)\n    const contours = new cv.MatVector()\n    const hierarchy = new cv.Mat()\n    cv.findContours(\n      dst,\n      contours,\n      hierarchy,\n      cv.RETR_CCOMP,\n      cv.CHAIN_APPROX_SIMPLE\n    )\n    const rect = cv.boundingRect(dst)\n    dst.delete()\n    hierarchy.delete()\n    contours.delete()\n    // transform the rectangle into a set of points\n    Object.keys(rect).forEach((key) => {\n      rect[key] = rect[key] * imageResizeRatio\n    })\n\n    const contourCoordinates = {\n      'left-top': { x: rect.x, y: rect.y },\n      'right-top': { x: rect.x + rect.width, y: rect.y },\n      'right-bottom': {\n        x: rect.x + rect.width,\n        y: rect.y + rect.height\n      },\n      'left-bottom': { x: rect.x, y: rect.y + rect.height }\n    }\n\n    setCropPoints(contourCoordinates)\n  }\n\n  const clearMagnifier = () => {\n    const magnCtx = magnifierCanvasRef.current.getContext('2d')\n    magnCtx.clearRect(\n      0,\n      0,\n      magnifierCanvasRef.current.width,\n      magnifierCanvasRef.current.height\n    )\n  }\n\n  useEffect(() => {\n    if (onChange) {\n      onChange({ ...cropPoints, loading })\n    }\n  }, [cropPoints, loading])\n\n  useEffect(() => {\n    const bootstrap = async () => {\n      const src = await readFile(image)\n      await createCanvas(src)\n      showPreview()\n      detectContours()\n      setLoading(false)\n    }\n\n    if (image && previewCanvasRef.current && cvLoaded && mode === 'crop') {\n      bootstrap()\n    } else {\n      setLoading(true)\n    }\n  }, [image, previewCanvasRef.current, cvLoaded, mode])\n\n  const onDrag = useCallback((position, area) => {\n    const { x, y } = position\n\n    const magnCtx = magnifierCanvasRef.current.getContext('2d')\n    clearMagnifier()\n\n    // TODO we should make those 5, 10 and 20 values proportionate\n    // to the point size\n    magnCtx.drawImage(\n      previewCanvasRef.current,\n      x - (pointSize - 10),\n      y - (pointSize - 10),\n      pointSize + 5,\n      pointSize + 5,\n      x + 10,\n      y - 90,\n      pointSize + 20,\n      pointSize + 20\n    )\n\n    setCropPoints((cPs) => ({ ...cPs, [area]: { x, y } }))\n  }, [])\n\n  const onStop = useCallback((position, area, cropPoints) => {\n    const { x, y } = position\n    clearMagnifier()\n    setCropPoints((cPs) => ({ ...cPs, [area]: { x, y } }))\n    if (onDragStop) {\n      onDragStop({ ...cropPoints, [area]: { x, y } })\n    }\n  }, [])\n\n  return (\n    <div\n      style={{\n        position: 'relative',\n        ...(previewDims && buildImgContainerStyle(previewDims))\n      }}\n    >\n      {previewDims && mode === 'crop' && cropPoints && (\n        <Fragment>\n          <CropPoints\n            pointSize={pointSize}\n            pointBgColor={pointBgColor}\n            pointBorder={pointBorder}\n            cropPoints={cropPoints}\n            previewDims={previewDims}\n            onDrag={onDrag}\n            onStop={onStop}\n            bounds={{\n              left: previewCanvasRef?.current?.offsetLeft - pointSize / 2,\n              top: previewCanvasRef?.current?.offsetTop - pointSize / 2,\n              right:\n                previewCanvasRef?.current?.offsetLeft -\n                pointSize / 2 +\n                previewCanvasRef?.current?.offsetWidth,\n              bottom:\n                previewCanvasRef?.current?.offsetTop -\n                pointSize / 2 +\n                previewCanvasRef?.current?.offsetHeight\n            }}\n          />\n          <CropPointsDelimiters\n            previewDims={previewDims}\n            cropPoints={cropPoints}\n            lineWidth={lineWidth}\n            lineColor={lineColor}\n            pointSize={pointSize}\n          />\n          <canvas\n            style={{\n              position: 'absolute',\n              zIndex: 5,\n              pointerEvents: 'none'\n            }}\n            width={previewDims.width}\n            height={previewDims.height}\n            ref={magnifierCanvasRef}\n          />\n        </Fragment>\n      )}\n\n      <canvas\n        style={{ zIndex: 5, pointerEvents: 'none' }}\n        ref={previewCanvasRef}\n      />\n    </div>\n  )\n}\n\nexport default Canvas\n\nCanvas.propTypes = {\n  image: T.object.isRequired,\n  onDragStop: T.func,\n  onChange: T.func,\n  cropperRef: T.shape({\n    current: T.shape({\n      done: T.func.isRequired,\n      backToCrop: T.func.isRequired\n    })\n  }),\n  pointSize: T.number,\n  lineWidth: T.number,\n  pointBgColor: T.string,\n  pointBorder: T.string,\n  lineColor: T.string\n}\n","import React from 'react'\nimport { OpenCvProvider } from 'opencv-react'\nimport Canvas from '../lib/Canvas'\nimport T from 'prop-types'\n\nconst Cropper = React.forwardRef((props, ref) => {\n  if (!props.image) {\n    return null\n  }\n\n  return (\n    <OpenCvProvider openCvPath={props.openCvPath}>\n      <Canvas {...props} cropperRef={ref} />\n    </OpenCvProvider>\n  )\n})\n\nexport default Cropper\n\nCropper.propTypes = {\n  openCvPath: T.string\n}\n"],"names":["readFile","file","File","Promise","resolve","reject","reader","FileReader","onload","event","result","onerror","err","readAsDataURL","calcDims","width","height","externalMaxWidth","externalMaxHeight","ratio","maxWidth","window","innerWidth","maxHeight","innerHeight","calculated","Math","round","isCrossOriginURL","url","location","parts","match","protocol","hostname","port","buildCropPointStyle","size","pointBgColor","pointBorder","backgroundColor","border","borderRadius","position","zIndex","CropPoint","cropPoints","pointArea","defaultPosition","pointSize","externalOnStop","onStop","externalOnDrag","onDrag","bounds","useCallback","_","x","y","React","propTypes","T","shape","number","isRequired","oneOf","string","func","CropPoints","props","previewDims","otherProps","transform","cv","docCanvas","imageResizeRatio","setPreviewPaneDimensions","dst","imread","bR","bL","tR","tL","sourceCoordinates","map","point","max","destCoordinates","Ms","matFromArray","CV_32FC2","concat","Md","transformMatrix","getPerspectiveTransform","dsize","Size","warpPerspective","INTER_LINEAR","BORDER_CONSTANT","Scalar","imshow","applyFilter","filterCvParams","options","blur","th","thMode","ADAPTIVE_THRESH_MEAN_C","thMeanCorrection","thBlockSize","thMax","grayScale","cvtColor","COLOR_RGBA2GRAY","ksize","GaussianBlur","BORDER_DEFAULT","adaptiveThreshold","THRESH_BINARY","convertTo","threshold","CropPointsDelimiters","lineWidth","lineColor","canvas","useRef","clearCanvas","ctx","current","getContext","clearRect","sortPoints","sortOrder","reduce","acc","pointPos","drawShape","point1","point2","point3","point4","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","useEffect","sortedPoints","buildImgContainerStyle","imageDimensions","Canvas","image","onDragStop","onChange","cropperRef","useOpenCv","cvLoaded","loaded","canvasRef","previewCanvasRef","magnifierCanvasRef","useState","setPreviewDims","setCropPoints","loading","setLoading","mode","setMode","useImperativeHandle","backToCrop","done","opts","preview","toBlob","blob","name","type","showPreview","newPreviewDims","createCanvas","src","img","document","createElement","drawImage","crossOrigin","Mat","resize","INTER_AREA","detectContours","Canny","contours","MatVector","hierarchy","findContours","RETR_CCOMP","CHAIN_APPROX_SIMPLE","rect","boundingRect","Object","keys","forEach","key","contourCoordinates","clearMagnifier","magnCtx","bootstrap","area","cPs","Fragment","left","offsetLeft","top","offsetTop","right","offsetWidth","bottom","offsetHeight","pointerEvents","object","Cropper","forwardRef","ref","OpenCvProvider","openCvPath"],"mappings":"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"}