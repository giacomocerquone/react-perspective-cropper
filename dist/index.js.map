{"version":3,"file":"index.js","sources":["../src/lib/utils.js","../src/lib/CropPoint.jsx","../src/lib/CropPoints.jsx","../src/lib/imgManipulation.js","../src/lib/CropPointsDelimiters.jsx","../src/lib/Canvas.jsx","../src/components/Cropper.jsx"],"sourcesContent":["export const readFile = (file) => {\n  if (file instanceof File) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onload = (event) => {\n        resolve(reader.result)\n      }\n      reader.onerror = (err) => {\n        reject(err)\n      }\n      reader.readAsDataURL(file)\n    })\n  }\n  if (typeof file === 'string') {\n    return Promise.resolve(file)\n  }\n}\n\nexport const calcDims = (\n  width,\n  height,\n  externalMaxWidth,\n  externalMaxHeight\n) => {\n  const ratio = width / height\n\n  const maxWidth = externalMaxWidth || window.innerWidth\n  const maxHeight = externalMaxHeight || window.innerHeight\n  const calculated = {\n    width: maxWidth,\n    height: Math.round(maxWidth / ratio),\n    ratio: ratio\n  }\n\n  if (calculated.height > maxHeight) {\n    calculated.height = maxHeight\n    calculated.width = Math.round(maxHeight * ratio)\n  }\n  return calculated\n}\n\nexport function isCrossOriginURL(url) {\n  const { location } = window;\n  const parts = url.match(/^(\\w+:)\\/\\/([^:/?#]*):?(\\d*)/i);\n\n  return (\n    parts !== null &&\n    (parts[1] !== location.protocol ||\n      parts[2] !== location.hostname ||\n      parts[3] !== location.port)\n  );\n}","import React, { useCallback } from 'react'\nimport Draggable from 'react-draggable'\nimport T from 'prop-types'\n\nconst buildCropPointStyle = (size, pointBgColor, pointBorder) => ({\n  width: size,\n  height: size,\n  backgroundColor: pointBgColor,\n  border: pointBorder,\n  borderRadius: '100%',\n  position: 'absolute',\n  zIndex: 1001\n})\n\nconst CropPoint = ({\n  cropPoints,\n  pointArea,\n  defaultPosition,\n  pointSize,\n  pointBgColor = 'transparent',\n  pointBorder = '4px solid #3cabe2',\n  onStop: externalOnStop,\n  onDrag: externalOnDrag,\n  bounds\n}) => {\n  const onDrag = useCallback(\n    (_, position) => {\n      externalOnDrag(\n        {\n          ...position,\n          x: position.x + pointSize / 2,\n          y: position.y + pointSize / 2\n        },\n        pointArea\n      )\n    },\n    [externalOnDrag]\n  )\n\n  const onStop = useCallback(\n    (_, position) => {\n      externalOnStop(\n        {\n          ...position,\n          x: position.x + pointSize / 2,\n          y: position.y + pointSize / 2\n        },\n        pointArea,\n        cropPoints\n      )\n    },\n    [externalOnDrag, cropPoints]\n  )\n\n  return (\n    <Draggable\n      bounds={bounds}\n      defaultPosition={defaultPosition}\n      position={{\n        x: cropPoints[pointArea].x - pointSize / 2,\n        y: cropPoints[pointArea].y - pointSize / 2\n      }}\n      onDrag={onDrag}\n      onStop={onStop}\n    >\n      <div style={buildCropPointStyle(pointSize, pointBgColor, pointBorder)} />\n    </Draggable>\n  )\n}\n\nexport default CropPoint\n\nCropPoint.propTypes = {\n  cropPoints: T.shape({\n    'left-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-bottom': T.shape({ x: T.number, y: T.number }).isRequired,\n    'left-bottom': T.shape({ x: T.number, y: T.number }).isRequired\n  }),\n  pointArea: T.oneOf(['left-top', 'right-top', 'right-bottom', 'left-bottom']),\n  defaultPosition: T.shape({\n    x: T.number,\n    y: T.number\n  }),\n  pointSize: T.number,\n  pointBgColor: T.string,\n  pointBorder: T.string,\n  onStop: T.func,\n  onDrag: T.func\n}\n","import React, { Fragment } from 'react'\nimport CropPoint from './CropPoint'\nimport T from 'prop-types'\n\nconst CropPoints = (props) => {\n  const { previewDims, ...otherProps } = props\n  return (\n    <>\n      <CropPoint\n        pointArea='left-top'\n        defaultPosition={{ x: 0, y: 0 }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='right-top'\n        defaultPosition={{ x: previewDims.width, y: 0 }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='right-bottom'\n        defaultPosition={{ x: 0, y: previewDims.height }}\n        {...otherProps}\n      />\n      <CropPoint\n        pointArea='left-bottom'\n        defaultPosition={{\n          x: previewDims.width,\n          y: previewDims.height\n        }}\n        {...otherProps}\n      />\n    </>\n  )\n}\n\nexport default CropPoints\n\nCropPoints.propTypes = {\n  previewDims: T.shape({\n    ratio: T.number,\n    width: T.number,\n    height: T.number\n  })\n}\n","export const transform = (\n  cv,\n  docCanvas,\n  cropPoints,\n  imageResizeRatio,\n  setPreviewPaneDimensions\n) => {\n  const dst = cv.imread(docCanvas)\n\n  const bR = cropPoints['right-bottom']\n  const bL = cropPoints['left-bottom']\n  const tR = cropPoints['right-top']\n  const tL = cropPoints['left-top']\n\n  // create source coordinates matrix\n  const sourceCoordinates = [tL, tR, bR, bL].map((point) => [\n    point.x / imageResizeRatio,\n    point.y / imageResizeRatio\n  ])\n\n  // get max width\n  const maxWidth = Math.max(bR.x - bL.x, tR.x - tL.x) / imageResizeRatio\n  // get max height\n  const maxHeight = Math.max(bL.y - tL.y, bR.y - tR.y) / imageResizeRatio\n\n  // create dest coordinates matrix\n  const destCoordinates = [\n    [0, 0],\n    [maxWidth - 1, 0],\n    [maxWidth - 1, maxHeight - 1],\n    [0, maxHeight - 1]\n  ]\n\n  // convert to open cv matrix objects\n  const Ms = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...sourceCoordinates))\n  const Md = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...destCoordinates))\n  const transformMatrix = cv.getPerspectiveTransform(Ms, Md)\n  // set new image size\n  const dsize = new cv.Size(maxWidth, maxHeight)\n  // perform warp\n  cv.warpPerspective(\n    dst,\n    dst,\n    transformMatrix,\n    dsize,\n    cv.INTER_LINEAR,\n    cv.BORDER_CONSTANT,\n    new cv.Scalar()\n  )\n  cv.imshow(docCanvas, dst)\n\n  dst.delete()\n  Ms.delete()\n  Md.delete()\n  transformMatrix.delete()\n\n  setPreviewPaneDimensions()\n}\n\nexport const applyFilter = async (cv, docCanvas, filterCvParams) => {\n  // default options\n  const options = {\n    blur: false,\n    th: true,\n    thMode: cv.ADAPTIVE_THRESH_MEAN_C,\n    thMeanCorrection: 15,\n    thBlockSize: 25,\n    thMax: 255,\n    grayScale: true,\n    ...filterCvParams\n  }\n  const dst = cv.imread(docCanvas)\n\n  if (options.grayScale) {\n    cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0)\n  }\n  if (options.blur) {\n    const ksize = new cv.Size(5, 5)\n    cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT)\n  }\n  if (options.th) {\n    if (options.grayScale) {\n      cv.adaptiveThreshold(\n        dst,\n        dst,\n        options.thMax,\n        options.thMode,\n        cv.THRESH_BINARY,\n        options.thBlockSize,\n        options.thMeanCorrection\n      )\n    } else {\n      dst.convertTo(dst, -1, 1, 60)\n      cv.threshold(dst, dst, 170, 255, cv.THRESH_BINARY)\n    }\n  }\n  cv.imshow(docCanvas, dst)\n}\n","import React, { useCallback, useEffect, useRef } from 'react'\nimport T from 'prop-types'\n\nconst CropPointsDelimiters = ({\n  cropPoints,\n  previewDims,\n  lineWidth = 3,\n  lineColor = '#3cabe2',\n  pointSize\n}) => {\n  const canvas = useRef()\n\n  const clearCanvas = useCallback(() => {\n    const ctx = canvas.current.getContext('2d')\n    ctx.clearRect(0, 0, previewDims.width, previewDims.height)\n  }, [canvas.current, previewDims])\n\n  const sortPoints = useCallback(() => {\n    const sortOrder = ['left-top', 'right-top', 'right-bottom', 'left-bottom']\n    return sortOrder.reduce(\n      (acc, pointPos) => [...acc, cropPoints[pointPos]],\n      []\n    )\n  }, [cropPoints])\n\n  const drawShape = useCallback(\n    ([point1, point2, point3, point4]) => {\n      const ctx = canvas.current.getContext('2d')\n      ctx.lineWidth = lineWidth\n      ctx.strokeStyle = lineColor\n\n      ctx.beginPath()\n      ctx.moveTo(point1.x + pointSize / 2, point1.y)\n      ctx.lineTo(point2.x - pointSize / 2, point2.y)\n\n      ctx.moveTo(point2.x, point2.y + pointSize / 2)\n      ctx.lineTo(point3.x, point3.y - pointSize / 2)\n\n      ctx.moveTo(point3.x - pointSize / 2, point3.y)\n      ctx.lineTo(point4.x + pointSize / 2, point4.y)\n\n      ctx.moveTo(point4.x, point4.y - pointSize / 2)\n      ctx.lineTo(point1.x, point1.y + pointSize / 2)\n      ctx.closePath()\n      ctx.stroke()\n    },\n    [canvas.current]\n  )\n\n  useEffect(() => {\n    if (cropPoints && canvas.current) {\n      clearCanvas()\n      const sortedPoints = sortPoints()\n      drawShape(sortedPoints)\n    }\n  }, [cropPoints, canvas.current])\n\n  return (\n    <canvas\n      ref={canvas}\n      style={{\n        position: 'absolute',\n        zIndex: 5\n      }}\n      width={previewDims.width}\n      height={previewDims.height}\n    />\n  )\n}\n\nexport default CropPointsDelimiters\n\nCropPointsDelimiters.propTypes = {\n  previewDims: T.shape({\n    ratio: T.number,\n    width: T.number,\n    height: T.number\n  }),\n  cropPoints: T.shape({\n    'left-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-top': T.shape({ x: T.number, y: T.number }).isRequired,\n    'right-bottom': T.shape({ x: T.number, y: T.number }).isRequired,\n    'left-bottom': T.shape({ x: T.number, y: T.number }).isRequired\n  }),\n  lineColor: T.string,\n  lineWidth: T.number,\n  pointSize: T.number\n}\n","import React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n  Fragment\n} from 'react'\nimport { useOpenCv } from 'opencv-react'\nimport T from 'prop-types'\n\nimport { calcDims, readFile, isCrossOriginURL } from '../lib/utils'\nimport CropPoints from '../lib/CropPoints'\nimport { applyFilter, transform } from '../lib/imgManipulation'\nimport CropPointsDelimiters from './CropPointsDelimiters'\n\nconst buildImgContainerStyle = (previewDims) => ({\n  width: previewDims.width,\n  height: previewDims.height\n})\n\nconst imageDimensions = { width: 0, height: 0 }\nlet imageResizeRatio\n\nconst Canvas = ({\n  image,\n  onDragStop,\n  onChange,\n  cropperRef,\n  pointSize = 30,\n  lineWidth,\n  pointBgColor,\n  pointBorder,\n  lineColor,\n  maxWidth,\n  maxHeight\n}) => {\n  const { loaded: cvLoaded, cv } = useOpenCv()\n  const canvasRef = useRef()\n  const previewCanvasRef = useRef()\n  const magnifierCanvasRef = useRef()\n  const [previewDims, setPreviewDims] = useState()\n  const [cropPoints, setCropPoints] = useState()\n  const [loading, setLoading] = useState(false)\n  const [mode, setMode] = useState('crop')\n\n  useImperativeHandle(cropperRef, () => ({\n    backToCrop: () => {\n      setMode('crop')\n    },\n    done: async (opts = {}) => {\n      return new Promise((resolve) => {\n        setLoading(true)\n        transform(\n          cv,\n          canvasRef.current,\n          cropPoints,\n          imageResizeRatio,\n          setPreviewPaneDimensions\n        )\n        applyFilter(cv, canvasRef.current, opts.filterCvParams)\n        if (opts.preview) {\n          setMode('preview')\n        }\n        canvasRef.current.toBlob((blob) => {\n          blob.name = image.name\n          resolve(blob)\n          setLoading(false)\n        }, image.type)\n      })\n    }\n  }))\n\n  useEffect(() => {\n    if (mode === 'preview') {\n      showPreview()\n    }\n  }, [mode])\n\n  const setPreviewPaneDimensions = () => {\n    // set preview pane dimensions\n    const newPreviewDims = calcDims(\n      canvasRef.current.width,\n      canvasRef.current.height,\n      maxWidth,\n      maxHeight\n    )\n    setPreviewDims(newPreviewDims)\n\n    previewCanvasRef.current.width = newPreviewDims.width\n    previewCanvasRef.current.height = newPreviewDims.height\n\n    imageResizeRatio = newPreviewDims.width / canvasRef.current.width\n  }\n\n  const createCanvas = (src) => {\n    return new Promise((resolve, reject) => {\n      const img = document.createElement('img')\n      img.onload = async () => {\n        // set edited image canvas and dimensions\n        canvasRef.current = document.createElement('canvas')\n        canvasRef.current.width = img.width\n        canvasRef.current.height = img.height\n        const ctx = canvasRef.current.getContext('2d')\n        ctx.drawImage(img, 0, 0)\n        imageDimensions.width = canvasRef.current.width\n        imageDimensions.height = canvasRef.current.height\n        setPreviewPaneDimensions()\n        resolve()\n      }\n      if (isCrossOriginURL(src)) img.crossOrigin = \"anonymous\"\n      img.src = src\n    })\n  }\n\n  const showPreview = (image) => {\n    const src = image || cv.imread(canvasRef.current)\n    const dst = new cv.Mat()\n    const dsize = new cv.Size(0, 0)\n    cv.resize(\n      src,\n      dst,\n      dsize,\n      imageResizeRatio,\n      imageResizeRatio,\n      cv.INTER_AREA\n    )\n    cv.imshow(previewCanvasRef.current, dst)\n    src.delete()\n    dst.delete()\n  }\n\n  const detectContours = () => {\n    const dst = cv.imread(canvasRef.current)\n    const ksize = new cv.Size(5, 5)\n    // convert the image to grayscale, blur it, and find edges in the image\n    cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0)\n    cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT)\n    cv.Canny(dst, dst, 75, 200)\n    // find contours\n    cv.threshold(dst, dst, 120, 200, cv.THRESH_BINARY)\n    const contours = new cv.MatVector()\n    const hierarchy = new cv.Mat()\n    cv.findContours(\n      dst,\n      contours,\n      hierarchy,\n      cv.RETR_CCOMP,\n      cv.CHAIN_APPROX_SIMPLE\n    )\n    const rect = cv.boundingRect(dst)\n    dst.delete()\n    hierarchy.delete()\n    contours.delete()\n    // transform the rectangle into a set of points\n    Object.keys(rect).forEach((key) => {\n      rect[key] = rect[key] * imageResizeRatio\n    })\n\n    const contourCoordinates = {\n      'left-top': { x: rect.x, y: rect.y },\n      'right-top': { x: rect.x + rect.width, y: rect.y },\n      'right-bottom': {\n        x: rect.x + rect.width,\n        y: rect.y + rect.height\n      },\n      'left-bottom': { x: rect.x, y: rect.y + rect.height }\n    }\n\n    setCropPoints(contourCoordinates)\n  }\n\n  const clearMagnifier = () => {\n    const magnCtx = magnifierCanvasRef.current.getContext('2d')\n    magnCtx.clearRect(\n      0,\n      0,\n      magnifierCanvasRef.current.width,\n      magnifierCanvasRef.current.height\n    )\n  }\n\n  useEffect(() => {\n    if (onChange) {\n      onChange({ ...cropPoints, loading })\n    }\n  }, [cropPoints, loading])\n\n  useEffect(() => {\n    const bootstrap = async () => {\n      const src = await readFile(image)\n      await createCanvas(src)\n      showPreview()\n      detectContours()\n      setLoading(false)\n    }\n\n    if (image && previewCanvasRef.current && cvLoaded && mode === 'crop') {\n      bootstrap()\n    } else {\n      setLoading(true)\n    }\n  }, [image, previewCanvasRef.current, cvLoaded, mode])\n\n  const onDrag = useCallback((position, area) => {\n    const { x, y } = position\n\n    const magnCtx = magnifierCanvasRef.current.getContext('2d')\n    clearMagnifier()\n\n    // TODO we should make those 5, 10 and 20 values proportionate\n    // to the point size\n    magnCtx.drawImage(\n      previewCanvasRef.current,\n      x - (pointSize - 10),\n      y - (pointSize - 10),\n      pointSize + 5,\n      pointSize + 5,\n      x + 10,\n      y - 90,\n      pointSize + 20,\n      pointSize + 20\n    )\n\n    setCropPoints((cPs) => ({ ...cPs, [area]: { x, y } }))\n  }, [])\n\n  const onStop = useCallback((position, area, cropPoints) => {\n    const { x, y } = position\n    clearMagnifier()\n    setCropPoints((cPs) => ({ ...cPs, [area]: { x, y } }))\n    if (onDragStop) {\n      onDragStop({ ...cropPoints, [area]: { x, y } })\n    }\n  }, [])\n\n  return (\n    <div\n      style={{\n        position: 'relative',\n        ...(previewDims && buildImgContainerStyle(previewDims))\n      }}\n    >\n      {previewDims && mode === 'crop' && cropPoints && (\n        <Fragment>\n          <CropPoints\n            pointSize={pointSize}\n            pointBgColor={pointBgColor}\n            pointBorder={pointBorder}\n            cropPoints={cropPoints}\n            previewDims={previewDims}\n            onDrag={onDrag}\n            onStop={onStop}\n            bounds={{\n              left: previewCanvasRef?.current?.offsetLeft - pointSize / 2,\n              top: previewCanvasRef?.current?.offsetTop - pointSize / 2,\n              right:\n                previewCanvasRef?.current?.offsetLeft -\n                pointSize / 2 +\n                previewCanvasRef?.current?.offsetWidth,\n              bottom:\n                previewCanvasRef?.current?.offsetTop -\n                pointSize / 2 +\n                previewCanvasRef?.current?.offsetHeight\n            }}\n          />\n          <CropPointsDelimiters\n            previewDims={previewDims}\n            cropPoints={cropPoints}\n            lineWidth={lineWidth}\n            lineColor={lineColor}\n            pointSize={pointSize}\n          />\n          <canvas\n            style={{\n              position: 'absolute',\n              zIndex: 5,\n              pointerEvents: 'none'\n            }}\n            width={previewDims.width}\n            height={previewDims.height}\n            ref={magnifierCanvasRef}\n          />\n        </Fragment>\n      )}\n\n      <canvas\n        style={{ zIndex: 5, pointerEvents: 'none' }}\n        ref={previewCanvasRef}\n      />\n    </div>\n  )\n}\n\nexport default Canvas\n\nCanvas.propTypes = {\n  image: T.object.isRequired,\n  onDragStop: T.func,\n  onChange: T.func,\n  cropperRef: T.shape({\n    current: T.shape({\n      done: T.func.isRequired,\n      backToCrop: T.func.isRequired\n    })\n  }),\n  pointSize: T.number,\n  lineWidth: T.number,\n  pointBgColor: T.string,\n  pointBorder: T.string,\n  lineColor: T.string\n}\n","import React from 'react'\nimport { OpenCvProvider } from 'opencv-react'\nimport Canvas from '../lib/Canvas'\nimport T from 'prop-types'\n\nconst Cropper = React.forwardRef((props, ref) => {\n  if (!props.image) {\n    return null\n  }\n\n  return (\n    <OpenCvProvider openCvPath={props.openCvPath}>\n      <Canvas {...props} cropperRef={ref} />\n    </OpenCvProvider>\n  )\n})\n\nexport default Cropper\n\nCropper.propTypes = {\n  openCvPath: T.string\n}\n"],"names":["readFile","file","File","Promise","resolve","reject","reader","FileReader","onload","event","result","onerror","err","readAsDataURL","calcDims","width","height","externalMaxWidth","externalMaxHeight","ratio","maxWidth","window","innerWidth","maxHeight","innerHeight","calculated","Math","round","isCrossOriginURL","url","location","parts","match","protocol","hostname","port","buildCropPointStyle","size","pointBgColor","pointBorder","backgroundColor","border","borderRadius","position","zIndex","CropPoint","cropPoints","pointArea","defaultPosition","pointSize","externalOnStop","onStop","externalOnDrag","onDrag","bounds","useCallback","_","x","y","React","propTypes","T","shape","number","isRequired","oneOf","string","func","CropPoints","props","previewDims","otherProps","transform","cv","docCanvas","imageResizeRatio","setPreviewPaneDimensions","dst","imread","bR","bL","tR","tL","sourceCoordinates","map","point","max","destCoordinates","Ms","matFromArray","CV_32FC2","concat","Md","transformMatrix","getPerspectiveTransform","dsize","Size","warpPerspective","INTER_LINEAR","BORDER_CONSTANT","Scalar","imshow","applyFilter","filterCvParams","options","blur","th","thMode","ADAPTIVE_THRESH_MEAN_C","thMeanCorrection","thBlockSize","thMax","grayScale","cvtColor","COLOR_RGBA2GRAY","ksize","GaussianBlur","BORDER_DEFAULT","adaptiveThreshold","THRESH_BINARY","convertTo","threshold","CropPointsDelimiters","lineWidth","lineColor","canvas","useRef","clearCanvas","ctx","current","getContext","clearRect","sortPoints","sortOrder","reduce","acc","pointPos","drawShape","point1","point2","point3","point4","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","useEffect","sortedPoints","buildImgContainerStyle","imageDimensions","Canvas","image","onDragStop","onChange","cropperRef","useOpenCv","cvLoaded","loaded","canvasRef","previewCanvasRef","magnifierCanvasRef","useState","setPreviewDims","setCropPoints","loading","setLoading","mode","setMode","useImperativeHandle","backToCrop","done","opts","preview","toBlob","blob","name","type","showPreview","newPreviewDims","createCanvas","src","img","document","createElement","drawImage","crossOrigin","Mat","resize","INTER_AREA","detectContours","Canny","contours","MatVector","hierarchy","findContours","RETR_CCOMP","CHAIN_APPROX_SIMPLE","rect","boundingRect","Object","keys","forEach","key","contourCoordinates","clearMagnifier","magnCtx","bootstrap","area","cPs","Fragment","left","offsetLeft","top","offsetTop","right","offsetWidth","bottom","offsetHeight","pointerEvents","object","Cropper","forwardRef","ref","OpenCvProvider","openCvPath"],"mappings":"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"}